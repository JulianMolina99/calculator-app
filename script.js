const buttons=document.getElementById("buttons"),screenOperation=document.getElementById("screen-operation"),screenResult=document.getElementById("screen-result");let currentState="state-0",lastNumber="",lastSimbol="",numberOfCharacters=0,length=0,result=0;const lastValue=()=>screenOperation.textContent.charAt(screenOperation.textContent.length-1),stringToValue=e=>Function(`return ${e}`)(),stateMachine=(e,t,n)=>{switch(e){case"state-0":switch(t){case"button-1":case"button-2":case"button-3":case"button-4":case"button-5":case"button-6":case"button-7":case"button-8":case"button-9":return screenOperation.textContent=n,"state-1";case"button-sum":case"button-substract":case"button-multiply":case"button-division":case"button-dot":return screenOperation.textContent="0"+n,"state-1";case"button-clear":return screenOperation.textContent="0",screenResult.textContent="0","state-0";default:return"state-0"}break;case"state-1":switch(t){case"button-0":case"button-1":case"button-2":case"button-3":case"button-4":case"button-5":case"button-6":case"button-7":case"button-8":case"button-9":return screenOperation.textContent+=n,"state-1";case"button-sum":case"button-substract":case"button-multiply":case"button-division":switch(lastValue()){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case")":screenOperation.textContent+=n;break;case"+":case"-":case"*":case"/":screenOperation.textContent=screenOperation.textContent.slice(0,-1)+n;break;case".":screenOperation.textContent+="0"+n}return"state-1";case"button-dot":switch(lastValue()){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":screenOperation.textContent+=".",length=screenOperation.textContent.length;for(let s=0;s<length;s++){if("."===screenOperation.textContent[length-2-s]){screenOperation.textContent=screenOperation.textContent.slice(0,-1);break}if(isNaN(screenOperation.textContent[length-2-s]))break}break;case"+":case"-":case"*":case"/":screenOperation.textContent+="0."}return"state-1";case"button-equal":return screenResult.textContent=stringToValue(screenOperation.textContent),"state-2";case"button-clear":return screenOperation.textContent="0",screenResult.textContent="0","state-0";case"button-percent":switch(lastValue()){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":result=0,length=screenOperation.textContent.length,numberOfCharacters=0,lastNumber="",lastSimbol="";for(let a=0;a<length;a++){if(isNaN(screenOperation.textContent[length-1-a])&&"."!==screenOperation.textContent[length-1-a]){lastSimbol=screenOperation.textContent[length-1-a],numberOfCharacters++;break}lastNumber+=screenOperation.textContent[length-1-a],numberOfCharacters++}switch(lastNumber=lastNumber.split("").reverse().join(""),lastSimbol){case"+":result=stringToValue(result=screenOperation.textContent.slice(0,-numberOfCharacters)),result=stringToValue(result+`*${lastNumber}/100`),screenOperation.textContent=screenOperation.textContent.slice(0,-numberOfCharacters)+"+"+result;break;case"-":result=stringToValue(result=screenOperation.textContent.slice(0,-numberOfCharacters)),result=stringToValue(result+`*${lastNumber}/100`),screenOperation.textContent=screenOperation.textContent.slice(0,-numberOfCharacters)+"-"+result;break;case"*":case"/":result=stringToValue(lastNumber+"/100"),screenOperation.textContent=screenOperation.textContent.slice(0,-numberOfCharacters+1)+result}break;case")":result=0,length=screenOperation.textContent.length,numberOfCharacters=3,lastNumber="";for(let r=0;r<length&&(!isNaN(screenOperation.textContent[length-2-r])||"."===screenOperation.textContent[length-2-r]);r++)lastNumber+=screenOperation.textContent[length-2-r],numberOfCharacters++;result=stringToValue((lastNumber=lastNumber.split("").reverse().join(""))+"/100"),screenOperation.textContent=screenOperation.textContent.slice(0,-numberOfCharacters)+`(-${result})`}return"state-1";case"button-delete":case"button-delete-span":if(numberOfCharacters=0,screenOperation.textContent.length<=1)return screenOperation.textContent="0","state-0";switch(lastValue()){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case".":case"+":case"-":case"*":case"/":screenOperation.textContent=screenOperation.textContent.slice(0,-1);break;case")":numberOfCharacters=3,length=screenOperation.textContent.length;for(let c=0;c<length&&(!isNaN(screenOperation.textContent[length-2-c])||"."===screenOperation.textContent[length-2-c]);c++)numberOfCharacters++;screenOperation.textContent=screenOperation.textContent.slice(0,-numberOfCharacters)}return"state-1";case"button-sign":switch(lastNumber="",lastSimbol="",numberOfCharacters=0,length=screenOperation.textContent.length,lastValue()){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(let o=0;o<length;o++){if(isNaN(screenOperation.textContent[length-1-o])&&"."!==screenOperation.textContent[length-1-o]){lastSimbol=screenOperation.textContent[length-1-o],numberOfCharacters++,console.log(lastSimbol);break}lastNumber+=screenOperation.textContent[length-1-o],numberOfCharacters++}switch(lastNumber=lastNumber.split("").reverse().join(""),lastSimbol){case"+":screenOperation.textContent=screenOperation.textContent.slice(0,-numberOfCharacters)+`-${lastNumber}`;break;case"-":case"":screenOperation.textContent=screenOperation.textContent.slice(0,-numberOfCharacters)+`+${lastNumber}`;break;case"*":case"/":numberOfCharacters--,screenOperation.textContent=screenOperation.textContent.slice(0,-numberOfCharacters)+`(-${lastNumber})`}break;case")":length=screenOperation.textContent.length;for(let u=0;u<length;u++){if(isNaN(screenOperation.textContent[length-2-u])&&"."!==screenOperation.textContent[length-2-u]){lastSimbol=screenOperation.textContent[length-2-u],numberOfCharacters+=3;break}lastNumber+=screenOperation.textContent[length-2-u],numberOfCharacters++}lastNumber=lastNumber.split("").reverse().join(""),console.log(lastNumber,numberOfCharacters),screenOperation.textContent=screenOperation.textContent.slice(0,-numberOfCharacters)+`${lastNumber}`}return"state-1"}break;case"state-2":switch(t){case"button-sum":case"button-substract":case"button-multiply":case"button-division":return screenOperation.textContent=screenResult.textContent+n,"state-1";case"button-0":return screenOperation.textContent=n,"state-0";case"button-dot":return screenOperation.textContent="0.","state-1";case"button-1":case"button-2":case"button-3":case"button-4":case"button-5":case"button-6":case"button-7":case"button-8":case"button-9":return screenOperation.textContent=n,"state-1";case"button-clear":return screenOperation.textContent=0,screenResult.textContent=0,"state-0";case"button-sign":case"button-delete":case"button-delete-span":case"button-percent":return"state-2"}}};buttons.addEventListener("click",e=>{e.target.id.includes("button")&&"buttons"!==e.target.id&&(currentState=stateMachine(currentState,e.target.id,e.target.textContent))});